<!-- DEBUG: show JS errors on page -->
<script>
  window.__showError = msg => {
    document.body.innerHTML = `
      <div style="padding:20px; font-family:monospace; background:#fff; color:#000;">
        <h2 style="color:#b91c1c;">DEBUG ‚Äî JavaScript Error</h2>
        <pre style="white-space:pre-wrap;">${String(msg)}</pre>
        <p style="opacity:.8;">(Remove this debug block once fixed)</p>
      </div>`;
  };

  window.onerror = function(message, source, lineno, colno, error) {
    const text = message + "\n\nsource: " + source + ":" + lineno + ":" + colno + "\n\n" + (error && error.stack ? error.stack : '');
    window.__showError(text);
    return true; // prevent further console noise
  };

  window.addEventListener('unhandledrejection', ev => {
    const reason = ev.reason && ev.reason.stack ? ev.reason.stack : JSON.stringify(ev.reason);
    window.__showError('Unhandled promise rejection:\\n' + reason);
  });
</script>






<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Weather App ‚Äî by You</title>
<meta name="description" content="Simple Weather App using OpenWeatherMap API. Search by city or use your current location." />
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --muted:#9aa7b2; --accent:#60a5fa;
    --glass: rgba(255,255,255,0.03);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    background:linear-gradient(180deg,#071024 0%, #0b1220 100%); color:#e6eef6;
    padding:24px;
  }
  .container{
    width:100%; max-width:720px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px; padding:20px; box-shadow: 0 8px 30px rgba(2,6,23,0.6);
    backdrop-filter: blur(6px);
  }
  header{display:flex; gap:12px; align-items:center; justify-content:space-between}
  h1{font-size:1.15rem; margin:0; letter-spacing:0.2px}
  .controls{display:flex; gap:8px; align-items:center}
  input[type="search"]{
    background:var(--glass); border:1px solid rgba(255,255,255,0.04); padding:10px 12px; border-radius:8px;
    color:inherit; outline:none; min-width:220px;
  }
  button{
    background:var(--accent); border:none; color:#07203a; padding:10px 12px; border-radius:8px; cursor:pointer;
    font-weight:600;
  }
  button.secondary{background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted)}
  .main{
    margin-top:18px; display:grid; grid-template-columns: 1fr 160px; gap:14px; align-items:center;
  }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    padding:18px; border-radius:10px; border:1px solid rgba(255,255,255,0.03);
  }
  .location{display:flex; gap:12px; align-items:center}
  .city{font-size:1.05rem; font-weight:700}
  .country{color:var(--muted); font-size:0.9rem}
  .temp{font-size:3rem; font-weight:700; margin-top:8px}
  .desc{margin-top:6px; color:var(--muted)}
  .stats{display:flex; gap:12px; margin-top:12px; flex-wrap:wrap}
  .stat{background:rgba(255,255,255,0.02); padding:8px 10px; border-radius:8px; font-size:0.9rem}
  .side{
    display:flex; flex-direction:column; gap:12px; align-items:center; justify-content:center;
  }
  .icon{width:120px; height:120px; display:flex; align-items:center; justify-content:center}
  .small{font-size:0.85rem; color:var(--muted)}
  footer{margin-top:14px; color:var(--muted); font-size:0.85rem; text-align:center}
  @media(max-width:640px){
    .main{grid-template-columns:1fr; }
    .icon{width:100px;height:100px}
  }
</style>
</head>
<body>
  <div class="container" role="application" aria-label="Weather App">
    <header>
      <h1>Weather App</h1>
      <div class="controls">
        <input id="q" type="search" placeholder="Search city (e.g. Manila)" aria-label="City search"/>
        <button id="searchBtn">Search</button>
        <button id="locBtn" class="secondary" title="Use current location">Use my location</button>
      </div>
    </header>

    <section class="main" aria-live="polite">
      <div class="card" id="result">
        <div class="location">
          <div>
            <div class="city" id="city">‚Äî</div>
            <div class="country" id="country"></div>
          </div>
          <div style="margin-left:auto">
            <div class="small">Units</div>
            <button id="unitBtn" class="secondary">¬∞C</button>
          </div>
        </div>

        <div class="temp" id="temp">--</div>
        <div class="desc" id="desc">No data yet. Search a city or use location.</div>

        <div class="stats" id="stats" aria-hidden="true"></div>
      </div>

      <div class="side card" style="text-align:center">
        <div class="icon" id="iconWrap">
          <!-- weather icon -->
          <img id="icon" src="" alt="" style="max-width:120px; display:none"/>
        </div>
        <div class="small" id="timeInfo">‚Äî</div>
        <div style="margin-top:8px">
          <button id="refreshBtn" class="secondary">Refresh</button>
        </div>
      </div>
    </section>

    <footer
        ¬© 2025 Weather App by Traci Timon üå§Ô∏è | Powered by OpenWeatherMap
    </footer>
  </div>

<script>
(() => {
  const API_KEY = 'af3e32257001892f3632ae0d6d2d7a93'; // ‚Üê replace this
  const elements = {
    q: document.getElementById('q'),
    searchBtn: document.getElementById('searchBtn'),
    locBtn: document.getElementById('locBtn'),
    refreshBtn: document.getElementById('refreshBtn'),
    unitBtn: document.getElementById('unitBtn'),
    city: document.getElementById('city'),
    country: document.getElementById('country'),
    temp: document.getElementById('temp'),
    desc: document.getElementById('desc'),
    stats: document.getElementById('stats'),
    icon: document.getElementById('icon'),
    iconWrap: document.getElementById('iconWrap'),
    timeInfo: document.getElementById('timeInfo')
  };

  let lastQuery = null;
  let unit = 'metric'; // metric = ¬∞C; imperial = ¬∞F

  function formatTime(ts, tzOffsetSec) {
    // ts in seconds, tzOffsetSec in seconds
    const d = new Date((ts + tzOffsetSec) * 1000);
    const hh = String(d.getUTCHours()).padStart(2,'0');
    const mm = String(d.getUTCMinutes()).padStart(2,'0');
    return `${hh}:${mm}`;
  }

  function showLoading() {
    elements.city.textContent = 'Loading‚Ä¶';
    elements.country.textContent = '';
    elements.temp.textContent = '--';
    elements.desc.textContent = 'Fetching weather‚Ä¶';
    elements.stats.innerHTML = '';
    elements.icon.style.display = 'none';
    elements.timeInfo.textContent = '';
  }

  function showError(msg) {
    elements.city.textContent = 'Error';
    elements.desc.textContent = msg || 'Could not fetch weather';
    elements.temp.textContent = '--';
    elements.stats.innerHTML = '';
    elements.icon.style.display = 'none';
    elements.timeInfo.textContent = '';
  }

  async function fetchWeatherByCity(city) {
    if (!city) return;
    lastQuery = {type:'city', q:city};
    showLoading();
    try {
      const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=${unit}`;
      const res = await fetch(url);
      if (!res.ok) {
        if (res.status === 404) showError('City not found.');
        else showError('Network error: ' + res.status);
        return;
      }
      const data = await res.json();
      render(data);
    } catch (err) {
      showError('Network or CORS error');
      console.error(err);
    }
  }

  async function fetchWeatherByCoords(lat, lon) {
    if (lat == null || lon == null) return;
    lastQuery = {type:'coords', lat, lon};
    showLoading();
    try {
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${unit}`;
      const res = await fetch(url);
      if (!res.ok) {
        showError('Network error: ' + res.status);
        return;
      }
      const data = await res.json();
      render(data);
    } catch (err) {
      showError('Network or CORS error');
      console.error(err);
    }
  }

  function kcToF(c){ return (c * 9/5) + 32; }

  function render(data) {
    if (!data || !data.main) { showError('Invalid response'); return; }
    const name = data.name + (data.sys && data.sys.country ? `, ${data.sys.country}` : '');
    elements.city.textContent = data.name || '‚Äî';
    elements.country.textContent = (data.sys && data.sys.country) ? data.sys.country : '';

    // Temperature string with unit symbol
    const symbol = (unit === 'metric') ? '¬∞C' : '¬∞F';
    const tempVal = Math.round(data.main.temp);
    elements.temp.textContent = `${tempVal}${symbol}`;

    elements.desc.textContent = (data.weather && data.weather[0] && data.weather[0].description) ? capitalize(data.weather[0].description) : '';

    // icon
    if (data.weather && data.weather[0] && data.weather[0].icon) {
      const iconCode = data.weather[0].icon;
      elements.icon.src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
      elements.icon.alt = data.weather[0].description || 'weather icon';
      elements.icon.style.display = 'block';
    } else {
      elements.icon.style.display = 'none';
    }

    // stats: feels_like, humidity, wind, sunrise/sunset
    let windSpeed = data.wind && (data.wind.speed != null) ? data.wind.speed : '‚Äî';
    // Units: metric = m/s, imperial = miles/hour. We'll display unit label.
    const windUnit = (unit === 'metric') ? 'm/s' : 'mph';
    // If windy value needs conversion when unit=imperial: OpenWeather returns wind speed in m/s for metric but in imperial returns miles/hour ‚Äî since we're requesting units in API it should already be correct.
    const feels = (data.main && data.main.feels_like != null) ? Math.round(data.main.feels_like) + symbol : '‚Äî';
    const humidity = (data.main && data.main.humidity != null) ? data.main.humidity + '%' : '‚Äî';
    const wind = (windSpeed !== '‚Äî') ? `${windSpeed} ${windUnit}` : '‚Äî';
    const tz = data.timezone || 0; // seconds
    const sunrise = data.sys && data.sys.sunrise ? formatTime(data.sys.sunrise, tz) : '‚Äî';
    const sunset = data.sys && data.sys.sunset ? formatTime(data.sys.sunset, tz) : '‚Äî';

    elements.stats.innerHTML = `
      <div class="stat">Feels: ${feels}</div>
      <div class="stat">Humidity: ${humidity}</div>
      <div class="stat">Wind: ${wind}</div>
      <div class="stat">Sunrise: ${sunrise}</div>
      <div class="stat">Sunset: ${sunset}</div>
    `;
    elements.stats.setAttribute('aria-hidden', 'false');

    elements.timeInfo.textContent = `Last update: ${new Date().toLocaleString()}`;
  }

  function capitalize(s){ return (s||'').split(' ').map(w => w[0]?.toUpperCase()+w.slice(1)).join(' '); }

  // events
  elements.searchBtn.addEventListener('click', () => {
    const v = elements.q.value.trim();
    if (!v) return;
    fetchWeatherByCity(v);
  });

  elements.q.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') elements.searchBtn.click();
  });

  elements.locBtn.addEventListener('click', () => {
    if (!navigator.geolocation) {
      showError('Geolocation not supported.');
      return;
    }
    navigator.geolocation.getCurrentPosition(pos => {
      fetchWeatherByCoords(pos.coords.latitude, pos.coords.longitude);
    }, err => {
      showError('Could not get location. Allow location and try again.');
    }, {timeout:10000});
  });

  elements.refreshBtn.addEventListener('click', () => {
    if (!lastQuery) return;
    if (lastQuery.type === 'city') fetchWeatherByCity(lastQuery.q);
    else fetchWeatherByCoords(lastQuery.lat, lastQuery.lon);
  });

  elements.unitBtn.addEventListener('click', () => {
    // toggle unit
    unit = (unit === 'metric') ? 'imperial' : 'metric';
    elements.unitBtn.textContent = (unit === 'metric') ? '¬∞C' : '¬∞F';
    // re-fetch last query if present
    if (lastQuery) {
      if (lastQuery.type === 'city') fetchWeatherByCity(lastQuery.q);
      else fetchWeatherByCoords(lastQuery.lat, lastQuery.lon);
    }
  });

  // Helpful default: popular city on load
  function init() {
    const defaultCity = 'Manila';
    // small delay so UI paints first
    setTimeout(() => fetchWeatherByCity(defaultCity), 300);
  }

  init();
})();
</script>
</body>
</html>


